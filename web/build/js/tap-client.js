(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};define(["jquery","flap","client-comm"],function(e,o,n){var r;return r=function(){function r(){this.gotHost=t(this.gotHost,this),this.keypressed=t(this.keypressed,this),this.keydowned=t(this.keydowned,this),this.receive=t(this.receive,this),this.disconnected=t(this.disconnected,this),this.connect=t(this.connect,this),e("body").addClass("client"),this.connectForm=e("#clientsub"),this.commLayer=new n,this.commLayer.on("receive",this.receive),this.commLayer.on("disconnected",this.disconnected),this.commLayer.on("badserver",function(t){return function(){return t.noHost()}}(this)),this.connectForm.on("submit",this.connect),this.isIos&&(e("#codenum").on("keydown",this.keydowned),e("#codenum").on("focus",function(t){return function(){return t.currentNum="",e("#nums").html("")}}(this))),this.currentNum="",o(),e("body").on("flap",function(t){return function(){return console.log("touched",Date.now()),t.commLayer.send({ev:"toucherated",time:Date.now()})}}(this)),e(window).on("scroll",function(){return e(window).scrollTop(0)})}return r.prototype.isIos=/(iPad|iPod|iPhone)/.test(window.navigator.userAgent),r.prototype.connect=function(t){var o;console.log("do connect"),t.preventDefault(),o=e("#codenum").val(),this.isIos&&(o=this.currentNum),this.commLayer.connect(o)},r.prototype.disconnected=function(){return e("#client_intro").show(),e("#client_play").hide(),e("body").removeClass("doflap touched"),e("#codenum").val("")},r.prototype.receive=function(t){return"host-attached"===t.ev?this.gotHost():"no-host"===t.ev?this.noHost():void 0},r.prototype.noHost=function(){return alert("Sorry, we couldn't find a partner with that ID. Try reloading both browsers."),this.commLayer.disconnect()},r.prototype.keydowned=function(t){return t.preventDefault(),t.stopPropagation(),8===t.keyCode?this.currentNum=this.currentNum.substr(0,this.currentNum.length-1):t.keyCode>=48&&t.keyCode<=57&&(this.currentNum+=String.fromCharCode(t.keyCode)),e("#nums").html(this.currentNum)},r.prototype.keypressed=function(t){return console.log(t,typeof t.keyCode),t.preventDefault(),t.stopPropagation(),[53,8].indexOf(t.keyCode)>-1?this.currentNum=this.currentNum.substr(0,this.currentNum.length-2):t.keyCode>=48&&t.keyCode<=57&&(this.currentNum+=String.fromCharCode(t.keyCode)),e("#nums").html(this.currentNum)},r.prototype.gotHost=function(){return e("#client_intro").hide(),e("#client_play").show(),e("body").addClass("doflap touched"),console.log("got host",arguments)},r}()})}).call(this);