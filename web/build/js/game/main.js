define(["game/buzz.min"],function(e){return function(){function n(e){for(var n=e+"=",t=document.cookie.split(";"),a=0;a<t.length;a++){var i=t[a].trim();if(0==i.indexOf(n))return i.substring(n.length,i.length)}return""}function t(){m=0,b=180,w=0,x=0,$("#player").css({y:0,x:0}),r($("#player")),P.stop(),P.play(),$(".pipe").remove(),B=new Array,$(".animated").css("animation-play-state","running"),$(".animated").css("-webkit-animation-play-state","running")}function a(){g=y.SplashScreen,t(),$("#splash").transition({opacity:1},2e3,"ease")}function i(){$("body").trigger("gameStarted"),g=y.GameScreen,$("#splash").stop(),$("#splash").transition({opacity:0},500,"ease"),p(),h&&$(".boundingbox").show();var e=1e3/60;E=setInterval(o,e),W=setInterval(f,2400),f(),c()}function r(e){w=Math.min(m/10*90,90),$(e).css({rotate:w,top:b})}function o(){var e=$("#player");m+=v,b+=m,r(e);var n=document.getElementById("player").getBoundingClientRect(),t=34,a=24,i=t-8*Math.sin(Math.abs(w)/90),o=(a+n.height)/2,s=(n.width-i)/2+n.left,c=(n.height-o)/2+n.top,p=s+i,l=c+o;if(h){var f=$("#playerbox");f.css("left",s),f.css("top",c),f.css("height",o),f.css("width",i)}if(n.bottom>=$("#land").offset().top)return void u();var g=$("#ceiling");if(c<=g.offset().top+g.height()&&(b=0),null!=B[0]){var y=B[0],S=y.children(".pipe_upper"),x=S.offset().top+S.height(),A=S.offset().left-2,I=A+_,M=x+O;if(h){var f=$("#pipebox");f.css("left",A),f.css("top",x),f.css("height",O),f.css("width",_)}return p>A&&!(c>x&&M>l)?void u():void(s>I&&(B.splice(0,1),d()))}}function s(){g==y.GameScreen?c():g==y.SplashScreen&&(t(),i())}function c(){m=S,k.stop(),k.play()}function p(e){var n=$("#bigscore");if(n.empty(),!e)for(var t=x.toString().split(""),a=0;a<t.length;a++)n.append("<img src='assets/font_big_"+t[a]+".png' alt='"+t[a]+"'>")}function u(){$(".animated").css("animation-play-state","paused"),$(".animated").css("-webkit-animation-play-state","paused");var e=$("#player").position().top+$("#player").width(),n=$("#flyarea").height(),t=Math.max(0,n-e);$("#player").transition({y:t+"px",rotate:90},1e3,"easeInOutCubic"),g=y.ScoreScreen,clearInterval(E),clearInterval(W),E=null,W=null,j.any()?l():C.play().bindOnce("ended",function(){G.play().bindOnce("ended",function(){l()})})}function l(){return g=y.SplashScreen,$("body").trigger("gameover",[x])}function d(){x+=1,z.stop(),z.play(),p()}function f(){$(".pipe").filter(function(){return $(this).position().left<=-100}).remove();var e=80,n=420-O-2*e,t=Math.floor(Math.random()*n+e),a=420-O-t,i=$('<div class="pipe animated"><div class="pipe_upper" style="height: '+t+'px;"></div><div class="pipe_lower" style="height: '+a+'px;"></div></div>');$("#flyarea").append(i),B.push(i)}var g,h=!1,y=Object.freeze({SplashScreen:0,GameScreen:1,ScoreScreen:2}),v=.15,m=0,b=180,w=0,S=-4.6,x=0,A=0,O=150,_=52,B=new Array,I=!1,M=30,k=new e.sound("assets/sounds/sfx_wing.ogg"),z=new e.sound("assets/sounds/sfx_point.ogg"),C=new e.sound("assets/sounds/sfx_hit.ogg"),G=new e.sound("assets/sounds/sfx_die.ogg"),P=new e.sound("assets/sounds/sfx_swooshing.ogg");e.all().setVolume(M);var E,W;$(document).ready(function(){"?debug"==window.location.search&&(h=!0),"?easy"==window.location.search&&(O=200);var e=n("highscore");""!=e&&(A=parseInt(e)),a()}),$("body").on("resetgame",t),$("body").on("flap",function(){s()}),$("#replay").click(function(){I&&(I=!1,P.stop(),P.play(),$("#scoreboard").transition({y:"-40px",opacity:0},1e3,"ease",function(){$("#scoreboard").css("display","none"),a()}))});var j={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Safari:function(){return navigator.userAgent.match(/OS X.*Safari/)&&!navigator.userAgent.match(/Chrome/)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return j.Android()||j.BlackBerry()||j.iOS()||j.Opera()||j.Safari()||j.Windows()}}}});